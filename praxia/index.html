<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="dark light">
    <meta name="description" content="Evidence-based behavioral training for families">
    <title>Praxia-1 | Cadencia | Grey Stratum</title>
    <link rel="icon" type="image/png" href="/my-favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/my-favicon/favicon.svg">
    <link rel="shortcut icon" href="/my-favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/my-favicon/apple-touch-icon.png">
    <link rel="manifest" href="/my-favicon/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;500&family=Fira+Code:wght@400;500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./grey-stratum.css">
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-gradus animated"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                    <div class="logo-text"><span class="logo-title">Praxia-1</span><span class="logo-protocol">[ Cadencia ]</span></div>
                </div>
                <div class="user-toggle">
                    <button class="toggle-btn active" id="toggle-custos">Custos</button>
                    <button class="toggle-btn" id="toggle-filius">Filius</button>
                </div>
                <div class="theme-toggle" title="Toggle theme">
                    <span class="theme-label" id="themeLabel">[ NOX ]</span>
                    <div class="theme-indicator"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Custos Home -->
            <section id="view-custos-home" class="view active">
                <h1 class="page-title">Salve</h1>
                <p class="page-subtitle">Building connection, one praxis at a time</p>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="stat-streak">0</div><div class="stat-label">Consecutio</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-sessions">0</div><div class="stat-label">Sessions</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-skills">0</div><div class="stat-label">Skills</div></div>
                </div>
                <div class="card action-card" onclick="showView('view-praxis-setup')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Initiate Praxis ]</div><div class="card-subtitle">15 minutes of focused connection</div></div>
                    <span class="chevron">›</span>
                </div>
                <div class="card action-card" onclick="showView('view-status-checkin')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Status Check ]</div><div class="card-subtitle">Track state and build awareness</div></div>
                    <span class="chevron">›</span>
                </div>
                <div class="card action-card" onclick="showView('view-respiro')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Respiro ]</div><div class="card-subtitle">Guided calming protocol</div></div>
                    <span class="chevron">›</span>
                </div>
                <div class="card action-card" onclick="showView('view-urgentia')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar" style="background:var(--status-failed)"></div><div class="gradus-bar" style="background:var(--status-failed)"></div><div class="gradus-bar" style="background:var(--status-failed)"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Urgentia ]</div><div class="card-subtitle">In-the-moment support and scripts</div></div>
                    <span class="chevron">›</span>
                </div>
                <div class="card action-card" onclick="showView('view-log-episode')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Log Episode ]</div><div class="card-subtitle">Record for pattern tracking</div></div>
                    <span class="chevron">›</span>
                </div>
            </section>

            <!-- Praxis Setup -->
            <section id="view-praxis-setup" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">← Revert</button>
                <h1 class="page-title">Praxis Session</h1>
                <p class="page-subtitle">15 minutes of child-led connection using PRIDE skills</p>
                <div class="card">
                    <div class="card-title mb-md">Protocol Preparation</div>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem; font-weight: 300;">Find a quiet space. Let your child choose the activity. Practice these skills:</p>
                    <div class="praxis-skills">
                        <div class="praxis-skill"><strong>P</strong>raise — Specific, labeled praise</div>
                        <div class="praxis-skill"><strong>R</strong>eflect — Mirror their words back</div>
                        <div class="praxis-skill"><strong>I</strong>mitate — Copy their play actions</div>
                        <div class="praxis-skill"><strong>D</strong>escribe — Narrate what they're doing</div>
                        <div class="praxis-skill"><strong>E</strong>njoy — Show genuine enthusiasm</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Current State Assessment</label>
                    <div class="mood-scale" id="pre-mood-scale">
                        <button class="mood-scale-btn" data-mood="1" onclick="selectPreMood(1)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="2" onclick="selectPreMood(2)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="3" onclick="selectPreMood(3)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="4" onclick="selectPreMood(4)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="5" onclick="selectPreMood(5)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    </div>
                </div>
                <button class="btn btn-primary btn-large btn-block" onclick="startPraxis()" id="start-praxis-btn" disabled>[ Initiate ]</button>
            </section>

            <!-- Praxis Active -->
            <section id="view-praxis-active" class="view">
                <div class="timer-container">
                    <div class="timer-ring">
                        <svg viewBox="0 0 200 200"><circle class="timer-ring-bg" cx="100" cy="100" r="90" /><circle class="timer-ring-progress" id="timer-progress" cx="100" cy="100" r="90" /></svg>
                        <div class="timer-display"><div class="timer-time" id="timer-display">15:00</div><div class="timer-label">Remaining</div></div>
                    </div>
                </div>
                <div class="skill-prompt">
                    <div class="skill-prompt-label">Current Skill Focus</div>
                    <div class="skill-prompt-text" id="skill-prompt-text">Labeled Praise</div>
                    <div class="skill-prompt-hint" id="skill-prompt-hint">"I love how carefully you're building that!"</div>
                    <div class="skill-counter">
                        <button class="skill-count-btn" onclick="decrementSkill()">−</button>
                        <span class="skill-count-value" id="skill-count">0</span>
                        <button class="skill-count-btn" onclick="incrementSkill()">+</button>
                    </div>
                </div>
                <p class="text-center" style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 1rem;">Increment each time you use this skill</p>
                <button class="btn btn-secondary btn-block" onclick="nextSkillPrompt()">[ Next Skill ]</button>
                <button class="btn btn-ghost btn-block mt-lg" onclick="endPraxisEarly()">[ Terminate Early ]</button>
            </section>

            <!-- Praxis Complete -->
            <section id="view-praxis-complete" class="view">
                <div class="text-center" style="padding: 2rem 0;">
                    <div class="modal-icon"><div class="gradus-confirm"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h1 class="page-title">Session Complete</h1>
                    <p class="page-subtitle">You practiced connection skills for <span id="session-duration">15</span> minutes</p>
                </div>
                <div class="card">
                    <div class="card-title mb-md">Skills Deployed</div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="final-praise">0</div><div class="stat-label">Praise</div></div>
                        <div class="stat-card"><div class="stat-value" id="final-reflect">0</div><div class="stat-label">Reflect</div></div>
                        <div class="stat-card"><div class="stat-value" id="final-describe">0</div><div class="stat-label">Describe</div></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Post-Session State</label>
                    <div class="mood-scale" id="post-mood-scale">
                        <button class="mood-scale-btn" data-mood="1" onclick="selectPostMood(1)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="2" onclick="selectPostMood(2)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="3" onclick="selectPostMood(3)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="4" onclick="selectPostMood(4)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="5" onclick="selectPostMood(5)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Session Notes (Optional)</label><textarea class="form-textarea" id="session-notes" placeholder="What went well? What was challenging?"></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveSession()" id="save-session-btn" disabled>[ Confirm Session ]</button>
            </section>

            <!-- Status Check-In -->
            <section id="view-status-checkin" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">← Revert</button>
                <h1 class="page-title">Status Check</h1>
                <p class="page-subtitle">Current intensity level assessment</p>
                <div class="gauge-container">
                    <div class="gauge-labels"><span class="gauge-label">Stable</span><span class="gauge-label">Elevated</span></div>
                    <div class="gauge-track" id="gauge-track"><div class="gauge-handle" id="gauge-handle">5</div></div>
                    <div class="gauge-labels"><span class="gauge-label">1</span><span class="gauge-label">10</span></div>
                </div>
                <div class="form-group"><label class="form-label">State Vocabulary</label><div class="state-vocabulary" id="state-vocabulary"></div></div>
                <div class="form-group"><label class="form-label">Context (Optional)</label><textarea class="form-textarea" id="status-context" placeholder="What triggered this state..."></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveStatusCheckin()">[ Confirm Status ]</button>
            </section>

            <!-- Respiro -->
            <section id="view-respiro" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">← Revert</button>
                <div class="respiro-dots" id="respiro-dots"><span class="respiro-dot active"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span></div>
                <div class="respiro-step">
                    <div class="respiro-visual step-halt" id="respiro-visual"><div class="gradus-large"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h2 class="respiro-title" id="respiro-title">Halt</h2>
                    <p class="respiro-instruction" id="respiro-instruction">Freeze. Do not react. Pause here.</p>
                </div>
                <div class="respiro-nav">
                    <button class="btn btn-secondary btn-large" id="respiro-prev" onclick="respiroPrev()" disabled>←</button>
                    <button class="btn btn-primary btn-large" id="respiro-next" onclick="respiroNext()">[ Next ]</button>
                </div>
            </section>

            <!-- Urgentia -->
            <section id="view-urgentia" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">← Revert</button>
                <div class="urgentia-header"><h2>Maintain Equanimity</h2><p>Your calm is contagious. Breathe first.</p></div>
                <div class="breathing-pacer"><span class="breathing-pacer-text" id="breathing-text">Inhale</span></div>
                <div class="section-label">Protocol Scripts</div>
                <div class="protocol-scripts">
                    <div class="protocol-script"><div class="protocol-script-label">Validate</div><div class="protocol-script-text">"I can see you're really upset right now. That's okay."</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Early Prompt</div><div class="protocol-script-text">"I notice your body is getting tense. Let's take a breath together."</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Offer Choice</div><div class="protocol-script-text">"Would you like to squeeze something or go to your calm spot?"</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Selective Ignore</div><div class="protocol-script-text">Stay present. Don't engage with provocations. Wait for calm.</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Post-Calm: Repair</div><div class="protocol-script-text">"That was hard. I'm glad you calmed down. Want to talk about what happened?"</div></div>
                </div>
                <button class="btn btn-secondary btn-block mt-lg" onclick="showView('view-respiro')">[ Initiate Respiro ]</button>
            </section>

            <!-- Log Episode -->
            <section id="view-log-episode" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">← Revert</button>
                <h1 class="page-title">Log Episode</h1>
                <p class="page-subtitle">Record for pattern analysis</p>
                <div class="form-group"><label class="form-label">Intensity (1-10)</label><div class="gauge-container"><div class="gauge-track" id="episode-gauge-track"><div class="gauge-handle" id="episode-gauge-handle">5</div></div></div></div>
                <div class="form-group"><label class="form-label">Trigger</label><input type="text" class="form-input" id="episode-trigger" placeholder="e.g., Asked to stop playing game"></div>
                <div class="form-group">
                    <label class="form-label">Interventions Applied</label>
                    <div class="state-vocabulary" id="intervention-options">
                        <span class="state-word" onclick="toggleIntervention(this, 'validation')">Validation</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'early-prompt')">Early Prompt</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'breathing')">Co-Breathing</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'choice')">Offered Choice</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'space')">Gave Space</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'respiro')">Respiro</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'ignore')">Selective Ignore</span>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Duration to Calm (minutes)</label><input type="number" class="form-input" id="episode-duration" placeholder="e.g., 10" min="1" max="120"></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="episode-notes" placeholder="What worked? What didn't?"></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveEpisode()">[ Confirm Episode ]</button>
            </section>

            <!-- Progressio -->
            <section id="view-progressio" class="view">
                <h1 class="page-title">Progressio</h1>
                <p class="page-subtitle">Your advancement over time</p>
                <div class="card"><div class="card-title mb-md">This Week</div><div class="progressio-calendar" id="progressio-calendar"></div></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="progress-streak">0</div><div class="stat-label">Consecutio</div></div>
                    <div class="stat-card"><div class="stat-value" id="progress-sessions">0</div><div class="stat-label">Sessions</div></div>
                    <div class="stat-card"><div class="stat-value" id="progress-episodes">0</div><div class="stat-label">Episodes</div></div>
                </div>
                <div class="card">
                    <div class="card-title mb-sm">Skills This Week</div>
                    <div class="card-subtitle mb-md">PRIDE skills deployed in praxis sessions</div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="weekly-praise">0</div><div class="stat-label">Praise</div></div>
                        <div class="stat-card"><div class="stat-value" id="weekly-reflect">0</div><div class="stat-label">Reflect</div></div>
                        <div class="stat-card"><div class="stat-value" id="weekly-describe">0</div><div class="stat-label">Describe</div></div>
                    </div>
                </div>
            </section>

            <!-- Filius Home -->
            <section id="view-filius-home" class="view">
                <h1 class="page-title" style="font-size: 1.75rem;">Salve</h1>
                <p class="page-subtitle" style="font-size: 1.125rem;">How are you feeling today?</p>
                <div class="filius-mood-grid" id="filius-mood-grid">
                    <button class="mood-btn" data-mood="1" onclick="selectFiliusMood(1, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="2" onclick="selectFiliusMood(2, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="3" onclick="selectFiliusMood(3, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="4" onclick="selectFiliusMood(4, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="5" onclick="selectFiliusMood(5, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                </div>
                <div class="card action-card" onclick="showView('view-filius-respiro')" style="margin-top: 1.5rem;">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title" style="font-size: 1rem;">[ Calm Down ]</div><div class="card-subtitle">Use the Respiro technique</div></div>
                    <span class="chevron">›</span>
                </div>
                <div class="card action-card" onclick="showView('view-filius-breathe')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title" style="font-size: 1rem;">[ Breathe ]</div><div class="card-subtitle">Follow the breathing pacer</div></div>
                    <span class="chevron">›</span>
                </div>
            </section>

            <!-- Filius Respiro -->
            <section id="view-filius-respiro" class="view">
                <button class="back-btn" onclick="showView('view-filius-home')">← Revert</button>
                <div class="respiro-dots" id="filius-respiro-dots"><span class="respiro-dot active"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span></div>
                <div class="respiro-step">
                    <div class="respiro-visual step-halt" id="filius-respiro-visual"><div class="gradus-large"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h2 class="respiro-title" id="filius-respiro-title" style="font-size: 2rem;">Halt</h2>
                    <p class="respiro-instruction" id="filius-respiro-instruction" style="font-size: 1.125rem;">Freeze like a statue!</p>
                </div>
                <div class="respiro-nav">
                    <button class="btn btn-secondary btn-large" id="filius-respiro-prev" onclick="filiusRespiroPrev()" disabled>←</button>
                    <button class="btn btn-primary btn-large" id="filius-respiro-next" onclick="filiusRespiroNext()">[ Next ]</button>
                </div>
            </section>

            <!-- Filius Breathe -->
            <section id="view-filius-breathe" class="view">
                <button class="back-btn" onclick="showView('view-filius-home')">← Revert</button>
                <h1 class="page-title text-center" style="font-size: 1.5rem; margin-top: 2rem;">Breathe With Me</h1>
                <p class="page-subtitle text-center" style="font-size: 1rem;">Follow the pacer</p>
                <div class="breathing-pacer" style="width: 180px; height: 180px; margin-top: 2rem;"><span class="breathing-pacer-text" id="filius-breathing-text" style="font-size: 1rem;">Inhale</span></div>
                <p class="text-center mt-lg" style="color: var(--text-secondary); font-size: 1rem; font-weight: 300;">Expand = breathe in<br>Contract = breathe out</p>
                <button class="btn btn-secondary btn-large btn-block mt-lg" onclick="showView('view-filius-home')">[ Confirmed ]</button>
            </section>
        </main>

        <nav class="bottom-nav">
            <button type="button" class="nav-item active"><div class="nav-icon"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div><span>Home</span></button>
            <button type="button" class="nav-item"><div class="nav-icon"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div><span>Progressio</span></button>
        </nav>

        <div class="modal-overlay" id="modal-confirm">
            <div class="modal">
                <div class="text-center">
                    <div class="modal-icon"><div class="gradus-confirm"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h3 class="modal-title" id="modal-title">Confirmed</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-weight: 300;" id="modal-message">Your data has been recorded.</p>
                    <button class="btn btn-primary" onclick="hideModal()">[ Dismiss ]</button>
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript Modules (flat structure) -->
    <script src="./storage.js"></script>
    <script src="./users.js"></script>
    <script src="./curriculum.js"></script>
    <script src="./rewards.js"></script>
    <script src="./app.js"></script>
</body>
</html>
