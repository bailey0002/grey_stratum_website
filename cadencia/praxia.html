<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="dark light">
    <title>Praxia-1 | Cadencia | Grey Stratum</title>
    <link rel="icon" type="image/png" href="/my-favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/my-favicon/favicon.svg">
    <link rel="shortcut icon" href="/my-favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/my-favicon/apple-touch-icon.png">
    <link rel="manifest" href="/my-favicon/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;500&family=Fira+Code:wght@400;500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root, [data-theme="dark"] {
            --bg-primary: #1A1D21;
            --bg-secondary: #22272E;
            --bg-card: #2D333B;
            --bg-elevated: #363D47;
            --text-primary: #E6EDF3;
            --text-secondary: #768390;
            --text-muted: #545D68;
            --accent: #5BA4B5;
            --accent-hover: #4A8A99;
            --accent-glow: rgba(91, 164, 181, 0.3);
            --status-confirmed: #4CAF50;
            --status-failed: #E05252;
            --border: #3D444D;
            --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 0 2px rgba(91, 164, 181, 0.3);
        }
        [data-theme="light"] {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F0F2F4;
            --bg-card: #FFFFFF;
            --bg-elevated: #F8F9FA;
            --text-primary: #1A1D21;
            --text-secondary: #4A4F54;
            --text-muted: #768390;
            --accent: #5BA4B5;
            --accent-hover: #4A8A99;
            --accent-glow: rgba(91, 164, 181, 0.2);
            --status-confirmed: #4CAF50;
            --status-failed: #E05252;
            --border: #D0D7DE;
            --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-glow: 0 0 0 2px rgba(91, 164, 181, 0.25);
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; background-color: var(--bg-primary); }
        body { font-family: 'Inter', -apple-system, sans-serif; font-weight: 300; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; -webkit-font-smoothing: antialiased; transition: background-color 0.3s ease, color 0.3s ease; }
        .app-container { max-width: 480px; margin: 0 auto; min-height: 100vh; background: var(--bg-primary); position: relative; }
        .header { background: var(--bg-secondary); padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; flex-wrap: wrap; }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-gradus { display: flex; align-items: center; gap: 3px; height: 1.5rem; }
        .gradus-bar { width: 3px; background-color: var(--accent); border-radius: 1.5px; transition: height 0.3s ease, opacity 0.3s ease; }
        .gradus-bar:nth-child(1) { height: 40%; opacity: 0.5; }
        .gradus-bar:nth-child(2) { height: 65%; opacity: 0.75; }
        .gradus-bar:nth-child(3) { height: 90%; opacity: 1; }
        [data-theme="light"] .gradus-bar:nth-child(1) { height: 90%; opacity: 1; }
        [data-theme="light"] .gradus-bar:nth-child(2) { height: 65%; opacity: 0.75; }
        [data-theme="light"] .gradus-bar:nth-child(3) { height: 40%; opacity: 0.5; }
        @keyframes gradusIlluminate { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
        .logo-gradus.animated .gradus-bar:nth-child(1) { animation: gradusIlluminate 2.4s ease-in-out infinite 0s; }
        .logo-gradus.animated .gradus-bar:nth-child(2) { animation: gradusIlluminate 2.4s ease-in-out infinite 0.15s; }
        .logo-gradus.animated .gradus-bar:nth-child(3) { animation: gradusIlluminate 2.4s ease-in-out infinite 0.3s; }
        .logo-text { display: flex; flex-direction: column; }
        .logo-title { font-family: 'Archivo', sans-serif; font-size: 1.25rem; font-weight: 300; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-primary); }
        .logo-protocol { font-family: 'Fira Code', monospace; font-size: 0.625rem; letter-spacing: 0.15em; color: var(--text-muted); }
        .user-toggle { display: flex; background: var(--bg-card); border-radius: 6px; padding: 3px; border: 1px solid var(--border); }
        .toggle-btn { padding: 0.5rem 0.875rem; border: none; background: transparent; font-family: 'Fira Code', monospace; font-size: 0.6875rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-muted); cursor: pointer; border-radius: 4px; transition: all 0.2s ease; }
        .toggle-btn.active { background: var(--accent); color: var(--bg-primary); }
        .theme-toggle { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; }
        .theme-label { font-family: 'Fira Code', monospace; font-size: 0.5625rem; letter-spacing: 0.15em; color: var(--text-muted); }
        .theme-indicator { display: flex; align-items: center; gap: 2px; }
        .theme-indicator .gradus-bar { width: 2px; background: var(--accent); border-radius: 1px; }
        .theme-indicator .gradus-bar:nth-child(1) { height: 6px; opacity: 0.5; }
        .theme-indicator .gradus-bar:nth-child(2) { height: 10px; opacity: 0.75; }
        .theme-indicator .gradus-bar:nth-child(3) { height: 14px; opacity: 1; }
        [data-theme="light"] .theme-indicator .gradus-bar:nth-child(1) { height: 14px; opacity: 1; }
        [data-theme="light"] .theme-indicator .gradus-bar:nth-child(2) { height: 10px; opacity: 0.75; }
        [data-theme="light"] .theme-indicator .gradus-bar:nth-child(3) { height: 6px; opacity: 0.5; }
        .main-content { padding: 1.5rem; padding-bottom: 100px; }
        .view { display: none; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .page-title { font-family: 'Archivo', sans-serif; font-size: 1.5rem; font-weight: 300; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-primary); margin-bottom: 0.25rem; }
        .page-subtitle { font-size: 0.9375rem; font-weight: 300; color: var(--text-secondary); margin-bottom: 1.5rem; }
        .section-label { font-family: 'Fira Code', monospace; font-size: 0.6875rem; letter-spacing: 0.15em; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.75rem; }
        .card { background: var(--bg-card); border-radius: 8px; padding: 1.25rem; box-shadow: var(--shadow-card); margin-bottom: 1rem; border: 1px solid var(--border); transition: all 0.2s ease; }
        .card:hover { box-shadow: var(--shadow-glow), var(--shadow-card); }
        .card-title { font-family: 'Archivo', sans-serif; font-weight: 400; font-size: 0.875rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-primary); }
        .card-subtitle { font-size: 0.8125rem; color: var(--text-secondary); margin-top: 0.25rem; font-weight: 300; }
        .card-icon { width: 40px; height: 40px; border-radius: 6px; display: flex; align-items: center; justify-content: center; background: var(--bg-elevated); border: 1px solid var(--border); }
        .card-icon .gradus-mini { display: flex; align-items: center; gap: 2px; height: 20px; }
        .card-icon .gradus-mini .gradus-bar { width: 2px; }
        .card-icon .gradus-mini .gradus-bar:nth-child(1) { height: 8px; }
        .card-icon .gradus-mini .gradus-bar:nth-child(2) { height: 12px; }
        .card-icon .gradus-mini .gradus-bar:nth-child(3) { height: 16px; }
        .action-card { display: flex; align-items: center; gap: 1rem; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .action-card:active { transform: scale(0.98); }
        .action-card .card-content { flex: 1; }
        .action-card .chevron { color: var(--text-muted); font-size: 1.25rem; }
        .action-card:hover .chevron { color: var(--accent); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.875rem 1.5rem; border: 1px solid transparent; border-radius: 6px; font-family: 'Fira Code', monospace; font-size: 0.75rem; letter-spacing: 0.15em; text-transform: uppercase; cursor: pointer; transition: all 0.2s ease; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--accent); color: var(--bg-primary); border-color: var(--accent); }
        .btn-primary:hover { background: var(--accent-hover); box-shadow: var(--shadow-glow); }
        .btn-secondary { background: var(--bg-card); color: var(--text-secondary); border-color: var(--border); }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
        .btn-ghost { background: transparent; color: var(--text-muted); padding: 0.5rem 0.75rem; }
        .btn-ghost:hover { color: var(--accent); }
        .btn-large { padding: 1rem 2rem; font-size: 0.8125rem; }
        .btn-block { width: 100%; }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--bg-card); border-radius: 8px; padding: 1rem; text-align: center; border: 1px solid var(--border); }
        .stat-value { font-family: 'Archivo', sans-serif; font-size: 1.75rem; font-weight: 300; color: var(--accent); }
        .stat-label { font-family: 'Fira Code', monospace; font-size: 0.625rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin-top: 0.25rem; }
        .timer-container { display: flex; flex-direction: column; align-items: center; padding: 2rem 0; }
        .timer-ring { position: relative; width: 200px; height: 200px; }
        .timer-ring svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .timer-ring-bg { fill: none; stroke: var(--border); stroke-width: 8; }
        .timer-ring-progress { fill: none; stroke: var(--accent); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 565; stroke-dashoffset: 0; transition: stroke-dashoffset 1s linear; filter: drop-shadow(0 0 6px var(--accent-glow)); }
        .timer-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .timer-time { font-family: 'Archivo', sans-serif; font-size: 2.5rem; font-weight: 300; letter-spacing: 0.1em; color: var(--text-primary); }
        .timer-label { font-family: 'Fira Code', monospace; font-size: 0.625rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-muted); margin-top: 0.5rem; }
        .skill-prompt { background: var(--bg-card); border: 1px solid var(--accent); border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; text-align: center; box-shadow: var(--shadow-glow); }
        .skill-prompt-label { font-family: 'Fira Code', monospace; font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--accent); margin-bottom: 0.5rem; }
        .skill-prompt-text { font-family: 'Archivo', sans-serif; font-size: 1.25rem; font-weight: 300; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-primary); margin-bottom: 0.5rem; }
        .skill-prompt-hint { font-size: 0.875rem; color: var(--text-secondary); font-style: italic; font-weight: 300; }
        .skill-counter { display: flex; align-items: center; justify-content: center; gap: 1.5rem; margin-top: 1.5rem; }
        .skill-count-btn { width: 48px; height: 48px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--accent); font-size: 1.5rem; cursor: pointer; transition: all 0.2s ease; }
        .skill-count-btn:hover { border-color: var(--accent); box-shadow: var(--shadow-glow); }
        .skill-count-btn:active { transform: scale(0.95); }
        .skill-count-value { font-family: 'Archivo', sans-serif; font-size: 2rem; font-weight: 300; color: var(--accent); min-width: 48px; text-align: center; }
        .gauge-container { padding: 1.5rem 0; }
        .gauge-track { position: relative; height: 48px; background: linear-gradient(to right, var(--accent) 0%, #E9A84A 50%, var(--status-failed) 100%); border-radius: 6px; margin: 1rem 0; }
        .gauge-handle { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: var(--bg-card); border-radius: 6px; box-shadow: var(--shadow-card); cursor: grab; display: flex; align-items: center; justify-content: center; font-family: 'Archivo', sans-serif; font-weight: 400; font-size: 1rem; color: var(--text-primary); border: 2px solid var(--bg-primary); touch-action: none; }
        .gauge-labels { display: flex; justify-content: space-between; padding: 0 0.25rem; }
        .gauge-label { font-family: 'Fira Code', monospace; font-size: 0.625rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-muted); }
        .state-vocabulary { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0; }
        .state-word { padding: 0.5rem 0.875rem; background: var(--bg-card); border-radius: 6px; font-family: 'Fira Code', monospace; font-size: 0.6875rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; border: 1px solid var(--border); }
        .state-word:hover { border-color: var(--accent); color: var(--accent); }
        .state-word.selected { background: var(--accent); color: var(--bg-primary); border-color: var(--accent); }
        .respiro-step { text-align: center; padding: 2rem 0; }
        .respiro-visual { width: 140px; height: 140px; margin: 0 auto 2rem; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: var(--bg-card); border: 1px solid var(--border); transition: all 0.3s ease; }
        .respiro-visual .gradus-large { display: flex; align-items: center; gap: 6px; height: 80px; }
        .respiro-visual .gradus-large .gradus-bar { width: 6px; border-radius: 3px; }
        .respiro-visual.step-halt { border-color: var(--status-failed); box-shadow: 0 0 20px rgba(224, 82, 82, 0.2); }
        .respiro-visual.step-halt .gradus-bar { background: var(--status-failed); }
        .respiro-visual.step-retreat { animation: contractVisual 3s ease-in-out infinite; }
        .respiro-visual.step-breathe { animation: breatheVisual 4s ease-in-out infinite; }
        .respiro-visual.step-reflect { border-color: #E9A84A; box-shadow: 0 0 20px rgba(233, 168, 74, 0.2); }
        .respiro-visual.step-reflect .gradus-bar { background: #E9A84A; }
        .respiro-visual.step-resolve { border-color: var(--status-confirmed); box-shadow: 0 0 20px rgba(76, 175, 80, 0.2); }
        .respiro-visual.step-resolve .gradus-bar { background: var(--status-confirmed); }
        @keyframes contractVisual { 0%, 100% { transform: scale(1); } 50% { transform: scale(0.85); } }
        @keyframes breatheVisual { 0%, 100% { transform: scale(0.9); } 50% { transform: scale(1.1); } }
        .respiro-title { font-family: 'Archivo', sans-serif; font-size: 1.75rem; font-weight: 300; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-primary); margin-bottom: 0.5rem; }
        .respiro-instruction { font-size: 1rem; font-weight: 300; color: var(--text-secondary); max-width: 280px; margin: 0 auto 2rem; }
        .respiro-nav { display: flex; gap: 1rem; justify-content: center; }
        .respiro-dots { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1.5rem; }
        .respiro-dot { width: 8px; height: 8px; border-radius: 4px; background: var(--border); transition: all 0.2s ease; }
        .respiro-dot.active { background: var(--accent); width: 24px; }
        .breathing-pacer { width: 160px; height: 160px; margin: 2rem auto; border-radius: 8px; background: var(--bg-card); border: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; animation: breathePacer 8s ease-in-out infinite; box-shadow: var(--shadow-glow); }
        .breathing-pacer-text { font-family: 'Archivo', sans-serif; font-size: 0.875rem; font-weight: 300; letter-spacing: 0.25em; text-transform: uppercase; color: var(--accent); }
        @keyframes breathePacer { 0%, 100% { transform: scale(0.8); opacity: 0.6; } 12.5% { transform: scale(1); opacity: 1; } 50% { transform: scale(1); opacity: 1; } 62.5% { transform: scale(0.8); opacity: 0.6; } }
        .urgentia-header { background: var(--status-failed); color: var(--text-primary); padding: 1.25rem; border-radius: 8px; margin-bottom: 1.5rem; text-align: center; }
        .urgentia-header h2 { font-family: 'Archivo', sans-serif; font-size: 1.25rem; font-weight: 300; letter-spacing: 0.2em; text-transform: uppercase; margin-bottom: 0.25rem; }
        .urgentia-header p { font-size: 0.875rem; font-weight: 300; opacity: 0.9; }
        .protocol-scripts { display: flex; flex-direction: column; gap: 0.75rem; }
        .protocol-script { background: var(--bg-card); border-radius: 8px; padding: 1rem 1.25rem; border-left: 3px solid var(--accent); }
        .protocol-script-label { font-family: 'Fira Code', monospace; font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.375rem; }
        .protocol-script-text { font-size: 0.9375rem; font-weight: 300; color: var(--text-primary); line-height: 1.5; }
        .filius-mood-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin: 2rem 0; }
        .mood-btn { aspect-ratio: 1; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; }
        .mood-btn .gradus-mood { display: flex; align-items: flex-end; gap: 2px; height: 24px; }
        .mood-btn .gradus-mood .gradus-bar { width: 3px; border-radius: 1.5px; transition: all 0.2s ease; }
        .mood-btn[data-mood="1"] .gradus-bar { background: var(--status-failed); }
        .mood-btn[data-mood="1"] .gradus-bar:nth-child(1) { height: 6px; }
        .mood-btn[data-mood="1"] .gradus-bar:nth-child(2) { height: 4px; }
        .mood-btn[data-mood="1"] .gradus-bar:nth-child(3) { height: 2px; }
        .mood-btn[data-mood="2"] .gradus-bar { background: #E9A84A; }
        .mood-btn[data-mood="2"] .gradus-bar:nth-child(1) { height: 8px; }
        .mood-btn[data-mood="2"] .gradus-bar:nth-child(2) { height: 6px; }
        .mood-btn[data-mood="2"] .gradus-bar:nth-child(3) { height: 4px; }
        .mood-btn[data-mood="3"] .gradus-bar { background: var(--text-muted); }
        .mood-btn[data-mood="3"] .gradus-bar:nth-child(1) { height: 10px; }
        .mood-btn[data-mood="3"] .gradus-bar:nth-child(2) { height: 10px; }
        .mood-btn[data-mood="3"] .gradus-bar:nth-child(3) { height: 10px; }
        .mood-btn[data-mood="4"] .gradus-bar { background: var(--accent); }
        .mood-btn[data-mood="4"] .gradus-bar:nth-child(1) { height: 10px; }
        .mood-btn[data-mood="4"] .gradus-bar:nth-child(2) { height: 14px; }
        .mood-btn[data-mood="4"] .gradus-bar:nth-child(3) { height: 18px; }
        .mood-btn[data-mood="5"] .gradus-bar { background: var(--status-confirmed); }
        .mood-btn[data-mood="5"] .gradus-bar:nth-child(1) { height: 14px; }
        .mood-btn[data-mood="5"] .gradus-bar:nth-child(2) { height: 18px; }
        .mood-btn[data-mood="5"] .gradus-bar:nth-child(3) { height: 22px; }
        .mood-btn:active { transform: scale(0.95); }
        .mood-btn.selected { border-color: var(--accent); box-shadow: var(--shadow-glow); }
        .form-group { margin-bottom: 1.25rem; }
        .form-label { display: block; font-family: 'Fira Code', monospace; font-size: 0.6875rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .form-input, .form-textarea { width: 100%; padding: 0.875rem 1rem; border: 1px solid var(--border); border-radius: 4px; font-family: 'Inter', sans-serif; font-size: 0.9375rem; font-weight: 300; color: var(--text-primary); background: var(--bg-card); transition: all 0.2s ease; }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--accent); box-shadow: var(--shadow-glow); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(26, 29, 33, 0.85); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 200; padding: 1.5rem; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border-radius: 8px; padding: 2rem; width: 100%; max-width: 320px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); border: 1px solid var(--border); animation: modalIn 0.3s ease; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-title { font-family: 'Archivo', sans-serif; font-size: 1.25rem; font-weight: 300; letter-spacing: 0.15em; text-transform: uppercase; text-align: center; margin-bottom: 0.75rem; }
        .modal-icon { display: flex; justify-content: center; margin-bottom: 1rem; }
        .modal-icon .gradus-confirm { display: flex; align-items: center; gap: 4px; height: 48px; }
        .modal-icon .gradus-confirm .gradus-bar { width: 4px; background: var(--status-confirmed); }
        .modal-icon .gradus-confirm .gradus-bar:nth-child(1) { height: 16px; }
        .modal-icon .gradus-confirm .gradus-bar:nth-child(2) { height: 28px; }
        .modal-icon .gradus-confirm .gradus-bar:nth-child(3) { height: 40px; }
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: var(--bg-secondary); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 0.75rem 0; padding-bottom: calc(0.75rem + env(safe-area-inset-bottom, 0)); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.5rem 1rem; background: none; border: none; color: var(--text-muted); font-family: 'Fira Code', monospace; font-size: 0.5625rem; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; border-radius: 6px; }
        .nav-item .nav-icon { display: flex; align-items: center; gap: 2px; height: 20px; }
        .nav-item .nav-icon .gradus-bar { width: 2px; background: currentColor; border-radius: 1px; }
        .nav-item .nav-icon .gradus-bar:nth-child(1) { height: 6px; }
        .nav-item .nav-icon .gradus-bar:nth-child(2) { height: 10px; }
        .nav-item .nav-icon .gradus-bar:nth-child(3) { height: 14px; }
        .nav-item.active { color: var(--accent); }
        .mood-scale { display: flex; gap: 0.5rem; justify-content: center; margin: 1rem 0; }
        .mood-scale-btn { width: 44px; height: 44px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .mood-scale-btn .gradus-scale { display: flex; align-items: flex-end; gap: 2px; height: 20px; }
        .mood-scale-btn .gradus-scale .gradus-bar { width: 2px; background: var(--accent); border-radius: 1px; }
        .mood-scale-btn[data-mood="1"] .gradus-scale .gradus-bar:nth-child(1) { height: 4px; }
        .mood-scale-btn[data-mood="1"] .gradus-scale .gradus-bar:nth-child(2) { height: 3px; }
        .mood-scale-btn[data-mood="1"] .gradus-scale .gradus-bar:nth-child(3) { height: 2px; }
        .mood-scale-btn[data-mood="2"] .gradus-scale .gradus-bar:nth-child(1) { height: 6px; }
        .mood-scale-btn[data-mood="2"] .gradus-scale .gradus-bar:nth-child(2) { height: 5px; }
        .mood-scale-btn[data-mood="2"] .gradus-scale .gradus-bar:nth-child(3) { height: 4px; }
        .mood-scale-btn[data-mood="3"] .gradus-scale .gradus-bar:nth-child(1) { height: 8px; }
        .mood-scale-btn[data-mood="3"] .gradus-scale .gradus-bar:nth-child(2) { height: 8px; }
        .mood-scale-btn[data-mood="3"] .gradus-scale .gradus-bar:nth-child(3) { height: 8px; }
        .mood-scale-btn[data-mood="4"] .gradus-scale .gradus-bar:nth-child(1) { height: 8px; }
        .mood-scale-btn[data-mood="4"] .gradus-scale .gradus-bar:nth-child(2) { height: 12px; }
        .mood-scale-btn[data-mood="4"] .gradus-scale .gradus-bar:nth-child(3) { height: 16px; }
        .mood-scale-btn[data-mood="5"] .gradus-scale .gradus-bar:nth-child(1) { height: 12px; }
        .mood-scale-btn[data-mood="5"] .gradus-scale .gradus-bar:nth-child(2) { height: 16px; }
        .mood-scale-btn[data-mood="5"] .gradus-scale .gradus-bar:nth-child(3) { height: 20px; }
        .mood-scale-btn.selected { border-color: var(--accent); box-shadow: var(--shadow-glow); }
        .praxis-skills { display: flex; flex-direction: column; gap: 0.5rem; }
        .praxis-skill { padding: 0.75rem 1rem; background: var(--bg-elevated); border-radius: 6px; border-left: 3px solid var(--accent); font-size: 0.875rem; }
        .praxis-skill strong { color: var(--accent); font-weight: 500; }
        .progressio-calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin: 1rem 0; }
        .calendar-day { aspect-ratio: 1; border-radius: 4px; background: var(--bg-card); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-family: 'Fira Code', monospace; font-size: 0.625rem; color: var(--text-muted); }
        .calendar-day.completed { background: var(--accent); border-color: var(--accent); color: var(--bg-primary); }
        .calendar-day.today { border-color: var(--accent); box-shadow: var(--shadow-glow); }
        .text-center { text-align: center; }
        .mb-sm { margin-bottom: 0.5rem; }
        .mb-md { margin-bottom: 1rem; }
        .mb-lg { margin-bottom: 1.5rem; }
        .mt-md { margin-top: 1rem; }
        .mt-lg { margin-top: 1.5rem; }
        .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0; background: none; border: none; color: var(--accent); font-family: 'Fira Code', monospace; font-size: 0.6875rem; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; margin-bottom: 1rem; }
        .exit-link { display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted); font-family: 'Fira Code', monospace; font-size: 0.625rem; letter-spacing: 0.1em; text-transform: uppercase; text-decoration: none; padding: 0.5rem; transition: color 0.2s ease; }
        .exit-link:hover { color: var(--accent); }
        @media (max-width: 380px) { .header-content { flex-wrap: wrap; justify-content: center; gap: 0.5rem; } .theme-label { display: none; } .exit-link span { display: none; } }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <a href="../protocols/cadencia.html" class="exit-link" title="Exit to Cadencia">← <span>Exit</span></a>
                <div class="logo">
                    <div class="logo-gradus animated"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                    <div class="logo-text"><span class="logo-title">Praxia-1</span><span class="logo-protocol">[ Cadencia ]</span></div>
                </div>
                <div class="user-toggle">
                    <button class="toggle-btn active" id="toggle-custos" onclick="switchUser('custos')">Custos</button>
                    <button class="toggle-btn" id="toggle-filius" onclick="switchUser('filius')">Filius</button>
                </div>
                <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                    <span class="theme-label" id="themeLabel">[ NOX ]</span>
                    <div class="theme-indicator"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                </div>
            </div>
        </header>
        <main class="main-content">
            <!-- Custos Home -->
            <section id="view-custos-home" class="view active">
                <h1 class="page-title">Salve</h1>
                <p class="page-subtitle">Building connection, one praxis at a time</p>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="stat-streak">0</div><div class="stat-label">Consecutio</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-sessions">0</div><div class="stat-label">Sessions</div></div>
                    <div class="stat-card"><div class="stat-value" id="stat-skills">0</div><div class="stat-label">Skills</div></div>
                </div>
                <div class="card action-card" onclick="showView('view-praxis-setup')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Initiate Praxis ]</div><div class="card-subtitle">15 minutes of focused connection</div></div>
                    <span class="chevron">â€º</span>
                </div>
                <div class="card action-card" onclick="showView('view-status-checkin')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Status Check ]</div><div class="card-subtitle">Track state and build awareness</div></div>
                    <span class="chevron">â€º</span>
                </div>
                <div class="card action-card" onclick="showView('view-respiro')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Respiro ]</div><div class="card-subtitle">Guided calming protocol</div></div>
                    <span class="chevron">â€º</span>
                </div>
                <div class="card action-card" onclick="showView('view-urgentia')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar" style="background:var(--status-failed)"></div><div class="gradus-bar" style="background:var(--status-failed)"></div><div class="gradus-bar" style="background:var(--status-failed)"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Urgentia ]</div><div class="card-subtitle">In-the-moment support and scripts</div></div>
                    <span class="chevron">â€º</span>
                </div>
                <div class="card action-card" onclick="showView('view-log-episode')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title">[ Log Episode ]</div><div class="card-subtitle">Record for pattern tracking</div></div>
                    <span class="chevron">â€º</span>
                </div>
            </section>

            <!-- Praxis Setup -->
            <section id="view-praxis-setup" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">â† Revert</button>
                <h1 class="page-title">Praxis Session</h1>
                <p class="page-subtitle">15 minutes of child-led connection using PRIDE skills</p>
                <div class="card">
                    <div class="card-title mb-md">Protocol Preparation</div>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem; font-weight: 300;">Find a quiet space. Let your child choose the activity. Your objective is to follow their lead and practice these skills:</p>
                    <div class="praxis-skills">
                        <div class="praxis-skill"><strong>P</strong>raise â€” Specific, labeled praise</div>
                        <div class="praxis-skill"><strong>R</strong>eflect â€” Mirror their words back</div>
                        <div class="praxis-skill"><strong>I</strong>mitate â€” Copy their play actions</div>
                        <div class="praxis-skill"><strong>D</strong>escribe â€” Narrate what they're doing</div>
                        <div class="praxis-skill"><strong>E</strong>njoy â€” Show genuine enthusiasm</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Current State Assessment</label>
                    <div class="mood-scale" id="pre-mood-scale">
                        <button class="mood-scale-btn" data-mood="1" onclick="selectPreMood(1)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="2" onclick="selectPreMood(2)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="3" onclick="selectPreMood(3)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="4" onclick="selectPreMood(4)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="5" onclick="selectPreMood(5)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    </div>
                </div>
                <button class="btn btn-primary btn-large btn-block" onclick="startPraxis()" id="start-praxis-btn" disabled>[ Initiate ]</button>
            </section>

            <!-- Praxis Active -->
            <section id="view-praxis-active" class="view">
                <div class="timer-container">
                    <div class="timer-ring">
                        <svg viewBox="0 0 200 200"><circle class="timer-ring-bg" cx="100" cy="100" r="90" /><circle class="timer-ring-progress" id="timer-progress" cx="100" cy="100" r="90" /></svg>
                        <div class="timer-display"><div class="timer-time" id="timer-display">15:00</div><div class="timer-label">Remaining</div></div>
                    </div>
                </div>
                <div class="skill-prompt">
                    <div class="skill-prompt-label">Current Skill Focus</div>
                    <div class="skill-prompt-text" id="skill-prompt-text">Labeled Praise</div>
                    <div class="skill-prompt-hint" id="skill-prompt-hint">"I love how carefully you're building that!"</div>
                    <div class="skill-counter">
                        <button class="skill-count-btn" onclick="decrementSkill()">âˆ’</button>
                        <span class="skill-count-value" id="skill-count">0</span>
                        <button class="skill-count-btn" onclick="incrementSkill()">+</button>
                    </div>
                </div>
                <p class="text-center" style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 1rem;">Increment each time you use this skill</p>
                <button class="btn btn-secondary btn-block" onclick="nextSkillPrompt()">[ Next Skill ]</button>
                <button class="btn btn-ghost btn-block mt-lg" onclick="endPraxisEarly()">[ Terminate Early ]</button>
            </section>

            <!-- Praxis Complete -->
            <section id="view-praxis-complete" class="view">
                <div class="text-center" style="padding: 2rem 0;">
                    <div class="modal-icon"><div class="gradus-confirm"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h1 class="page-title">Session Complete</h1>
                    <p class="page-subtitle">You practiced connection skills for <span id="session-duration">15</span> minutes</p>
                </div>
                <div class="card">
                    <div class="card-title mb-md">Skills Deployed</div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="final-praise">0</div><div class="stat-label">Praise</div></div>
                        <div class="stat-card"><div class="stat-value" id="final-reflect">0</div><div class="stat-label">Reflect</div></div>
                        <div class="stat-card"><div class="stat-value" id="final-describe">0</div><div class="stat-label">Describe</div></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Post-Session State</label>
                    <div class="mood-scale" id="post-mood-scale">
                        <button class="mood-scale-btn" data-mood="1" onclick="selectPostMood(1)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="2" onclick="selectPostMood(2)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="3" onclick="selectPostMood(3)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="4" onclick="selectPostMood(4)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                        <button class="mood-scale-btn" data-mood="5" onclick="selectPostMood(5)"><div class="gradus-scale"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Session Notes (Optional)</label><textarea class="form-textarea" id="session-notes" placeholder="What went well? What was challenging?"></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveSession()" id="save-session-btn" disabled>[ Confirm Session ]</button>
            </section>

            <!-- Status Check-In -->
            <section id="view-status-checkin" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">â† Revert</button>
                <h1 class="page-title">Status Check</h1>
                <p class="page-subtitle">Current intensity level assessment</p>
                <div class="gauge-container">
                    <div class="gauge-labels"><span class="gauge-label">Stable</span><span class="gauge-label">Elevated</span></div>
                    <div class="gauge-track" id="gauge-track"><div class="gauge-handle" id="gauge-handle">5</div></div>
                    <div class="gauge-labels"><span class="gauge-label">1</span><span class="gauge-label">10</span></div>
                </div>
                <div class="form-group"><label class="form-label">State Vocabulary</label><div class="state-vocabulary" id="state-vocabulary"></div></div>
                <div class="form-group"><label class="form-label">Context (Optional)</label><textarea class="form-textarea" id="status-context" placeholder="What triggered this state..."></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveStatusCheckin()">[ Confirm Status ]</button>
            </section>

            <!-- Respiro -->
            <section id="view-respiro" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">â† Revert</button>
                <div class="respiro-dots" id="respiro-dots"><span class="respiro-dot active"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span></div>
                <div class="respiro-step">
                    <div class="respiro-visual step-halt" id="respiro-visual"><div class="gradus-large"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h2 class="respiro-title" id="respiro-title">Halt</h2>
                    <p class="respiro-instruction" id="respiro-instruction">Freeze. Do not react. Pause here.</p>
                </div>
                <div class="respiro-nav">
                    <button class="btn btn-secondary btn-large" id="respiro-prev" onclick="respiroPrev()" disabled>â†</button>
                    <button class="btn btn-primary btn-large" id="respiro-next" onclick="respiroNext()">[ Next ]</button>
                </div>
            </section>

            <!-- Urgentia -->
            <section id="view-urgentia" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">â† Revert</button>
                <div class="urgentia-header"><h2>Maintain Equanimity</h2><p>Your calm is contagious. Breathe first.</p></div>
                <div class="breathing-pacer"><span class="breathing-pacer-text" id="breathing-text">Inhale</span></div>
                <div class="section-label">Protocol Scripts</div>
                <div class="protocol-scripts">
                    <div class="protocol-script"><div class="protocol-script-label">Validate</div><div class="protocol-script-text">"I can see you're really upset right now. That's okay."</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Early Prompt</div><div class="protocol-script-text">"I notice your body is getting tense. Let's take a breath together."</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Offer Choice</div><div class="protocol-script-text">"Would you like to squeeze something or go to your calm spot?"</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Selective Ignore</div><div class="protocol-script-text">Stay present. Don't engage with provocations. Wait for calm.</div></div>
                    <div class="protocol-script"><div class="protocol-script-label">Post-Calm: Repair</div><div class="protocol-script-text">"That was hard. I'm glad you calmed down. Want to talk about what happened?"</div></div>
                </div>
                <button class="btn btn-secondary btn-block mt-lg" onclick="showView('view-respiro')">[ Initiate Respiro ]</button>
            </section>

            <!-- Log Episode -->
            <section id="view-log-episode" class="view">
                <button class="back-btn" onclick="showView('view-custos-home')">â† Revert</button>
                <h1 class="page-title">Log Episode</h1>
                <p class="page-subtitle">Record for pattern analysis</p>
                <div class="form-group"><label class="form-label">Intensity (1-10)</label><div class="gauge-container"><div class="gauge-track" id="episode-gauge-track"><div class="gauge-handle" id="episode-gauge-handle">5</div></div></div></div>
                <div class="form-group"><label class="form-label">Trigger</label><input type="text" class="form-input" id="episode-trigger" placeholder="e.g., Asked to stop playing game"></div>
                <div class="form-group">
                    <label class="form-label">Interventions Applied</label>
                    <div class="state-vocabulary" id="intervention-options">
                        <span class="state-word" onclick="toggleIntervention(this, 'validation')">Validation</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'early-prompt')">Early Prompt</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'breathing')">Co-Breathing</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'choice')">Offered Choice</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'space')">Gave Space</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'respiro')">Respiro</span>
                        <span class="state-word" onclick="toggleIntervention(this, 'ignore')">Selective Ignore</span>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Duration to Calm (minutes)</label><input type="number" class="form-input" id="episode-duration" placeholder="e.g., 10" min="1" max="120"></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="episode-notes" placeholder="What worked? What didn't?"></textarea></div>
                <button class="btn btn-primary btn-large btn-block" onclick="saveEpisode()">[ Confirm Episode ]</button>
            </section>

            <!-- Progressio -->
            <section id="view-progressio" class="view">
                <h1 class="page-title">Progressio</h1>
                <p class="page-subtitle">Your advancement over time</p>
                <div class="card"><div class="card-title mb-md">This Week</div><div class="progressio-calendar" id="progressio-calendar"></div></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="progress-streak">0</div><div class="stat-label">Consecutio</div></div>
                    <div class="stat-card"><div class="stat-value" id="progress-sessions">0</div><div class="stat-label">Sessions</div></div>
                    <div class="stat-card"><div class="stat-value" id="progress-episodes">0</div><div class="stat-label">Episodes</div></div>
                </div>
                <div class="card">
                    <div class="card-title mb-sm">Skills This Week</div>
                    <div class="card-subtitle mb-md">PRIDE skills deployed in praxis sessions</div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="weekly-praise">0</div><div class="stat-label">Praise</div></div>
                        <div class="stat-card"><div class="stat-value" id="weekly-reflect">0</div><div class="stat-label">Reflect</div></div>
                        <div class="stat-card"><div class="stat-value" id="weekly-describe">0</div><div class="stat-label">Describe</div></div>
                    </div>
                </div>
            </section>

            <!-- Filius Home -->
            <section id="view-filius-home" class="view">
                <h1 class="page-title" style="font-size: 1.75rem;">Salve</h1>
                <p class="page-subtitle" style="font-size: 1.125rem;">How are you feeling today?</p>
                <div class="filius-mood-grid" id="filius-mood-grid">
                    <button class="mood-btn" data-mood="1" onclick="selectFiliusMood(1, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="2" onclick="selectFiliusMood(2, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="3" onclick="selectFiliusMood(3, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="4" onclick="selectFiliusMood(4, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                    <button class="mood-btn" data-mood="5" onclick="selectFiliusMood(5, this)"><div class="gradus-mood"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></button>
                </div>
                <div class="card action-card" onclick="showView('view-filius-respiro')" style="margin-top: 1.5rem;">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title" style="font-size: 1rem;">[ Calm Down ]</div><div class="card-subtitle">Use the Respiro technique</div></div>
                    <span class="chevron">â€º</span>
                </div>
                <div class="card action-card" onclick="showView('view-filius-breathe')">
                    <div class="card-icon"><div class="gradus-mini"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <div class="card-content"><div class="card-title" style="font-size: 1rem;">[ Breathe ]</div><div class="card-subtitle">Follow the breathing pacer</div></div>
                    <span class="chevron">â€º</span>
                </div>
            </section>

            <!-- Filius Respiro -->
            <section id="view-filius-respiro" class="view">
                <button class="back-btn" onclick="showView('view-filius-home')">â† Revert</button>
                <div class="respiro-dots" id="filius-respiro-dots"><span class="respiro-dot active"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span><span class="respiro-dot"></span></div>
                <div class="respiro-step">
                    <div class="respiro-visual step-halt" id="filius-respiro-visual"><div class="gradus-large"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h2 class="respiro-title" id="filius-respiro-title" style="font-size: 2rem;">Halt</h2>
                    <p class="respiro-instruction" id="filius-respiro-instruction" style="font-size: 1.125rem;">Freeze like a statue!</p>
                </div>
                <div class="respiro-nav">
                    <button class="btn btn-secondary btn-large" id="filius-respiro-prev" onclick="filiusRespiroPrev()" disabled>â†</button>
                    <button class="btn btn-primary btn-large" id="filius-respiro-next" onclick="filiusRespiroNext()">[ Next ]</button>
                </div>
            </section>

            <!-- Filius Breathe -->
            <section id="view-filius-breathe" class="view">
                <button class="back-btn" onclick="showView('view-filius-home')">â† Revert</button>
                <h1 class="page-title text-center" style="font-size: 1.5rem; margin-top: 2rem;">Breathe With Me</h1>
                <p class="page-subtitle text-center" style="font-size: 1rem;">Follow the pacer</p>
                <div class="breathing-pacer" style="width: 180px; height: 180px; margin-top: 2rem;"><span class="breathing-pacer-text" id="filius-breathing-text" style="font-size: 1rem;">Inhale</span></div>
                <p class="text-center mt-lg" style="color: var(--text-secondary); font-size: 1rem; font-weight: 300;">Expand = breathe in<br>Contract = breathe out</p>
                <button class="btn btn-secondary btn-large btn-block mt-lg" onclick="showView('view-filius-home')">[ Confirmed ]</button>
            </section>
        </main>
        <nav class="bottom-nav">
            <button type="button" class="nav-item active" onclick="navigateTo('home')"><div class="nav-icon" aria-hidden="true"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                        <span>Home</span></button>
            <button type="button" class="nav-item" onclick="navigateTo('progressio')"><div class="nav-icon" aria-hidden="true"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div>
                        <span>Progressio</span></button>
        </nav>
        <div class="modal-overlay" id="modal-confirm">
            <div class="modal">
                <div class="text-center">
                    <div class="modal-icon"><div class="gradus-confirm"><div class="gradus-bar"></div><div class="gradus-bar"></div><div class="gradus-bar"></div></div></div>
                    <h3 class="modal-title" id="modal-title">Confirmed</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-weight: 300;" id="modal-message">Your data has been recorded.</p>
                    <button class="btn btn-primary" onclick="hideModal()">[ Dismiss ]</button>
                </div>
            </div>
        </div>
    </div>

<script>
'use strict';

/* ----------------------------
   Minimal app state + storage
----------------------------- */
const STORAGE_KEY = 'praxia_v1';
const DEFAULT_DATA = {
  theme: document.documentElement.getAttribute('data-theme') || 'dark',
  activeUser: 'custos',
  sessions: [],
  episodes: [],
  statusCheckins: []
};

function loadData() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? { ...DEFAULT_DATA, ...JSON.parse(raw) } : structuredClone(DEFAULT_DATA);
  } catch {
    return structuredClone(DEFAULT_DATA);
  }
}

function saveData(d) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
}

let data = loadData();

/* ----------------------------
   Dashboard update
----------------------------- */
function computeStreak(sessionDates) {
  if (!sessionDates || sessionDates.size === 0) return 0;
  
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const sorted = Array.from(sessionDates).sort().reverse();
  let streak = 0;
  let checkDate = today.getTime();
  const DAY_MS = 86400000;
  
  for (const dateStr of sorted) {
    const d = new Date(dateStr);
    d.setHours(0, 0, 0, 0);
    const dTime = d.getTime();
    
    if (dTime === checkDate || dTime === checkDate - DAY_MS) {
      streak++;
      checkDate = dTime;
    } else if (dTime < checkDate - DAY_MS) {
      break;
    }
  }
  
  return streak;
}

function updateDashboard() {
  const sessions = data.sessions || [];
  const sessionDates = new Set(sessions.map(s => (s.date || '').slice(0, 10)));
  
  const streak = computeStreak(sessionDates);
  const totalSkills = sessions.reduce((sum, s) => {
    const skills = s.skills || {};
    return sum + (skills.praise || 0) + (skills.reflect || 0) + 
           (skills.imitate || 0) + (skills.describe || 0) + (skills.enjoy || 0);
  }, 0);
  
  const streakEl = document.getElementById('stat-streak');
  const sessionsEl = document.getElementById('stat-sessions');
  const skillsEl = document.getElementById('stat-skills');
  
  if (streakEl) streakEl.textContent = String(streak);
  if (sessionsEl) sessionsEl.textContent = String(sessions.length);
  if (skillsEl) skillsEl.textContent = String(totalSkills);
}

/* ----------------------------
   View + navigation
----------------------------- */
function showView(viewId) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  const el = document.getElementById(viewId);
  if (el) el.classList.add('active');
}

function setActiveNav(key) {
  document.querySelectorAll('.bottom-nav .nav-item').forEach(b => b.classList.remove('active'));
  if (key === 'home') document.querySelector('.bottom-nav .nav-item:nth-child(1)')?.classList.add('active');
  if (key === 'progressio') document.querySelector('.bottom-nav .nav-item:nth-child(2)')?.classList.add('active');
}

function navigateTo(dest) {
  if (dest === 'home') {
    showView(data.activeUser === 'filius' ? 'view-filius-home' : 'view-custos-home');
    setActiveNav('home');
    return;
  }
  if (dest === 'progressio') {
    showView('view-progressio');
    setActiveNav('progressio');
    updateProgressio();
  }
}

function switchUser(user) {
  data.activeUser = user === 'filius' ? 'filius' : 'custos';
  saveData(data);
  
  // Update toggle button states
  const custosBtn = document.getElementById('toggle-custos');
  const filiusBtn = document.getElementById('toggle-filius');
  if (custosBtn) custosBtn.classList.toggle('active', data.activeUser === 'custos');
  if (filiusBtn) filiusBtn.classList.toggle('active', data.activeUser === 'filius');
  
  navigateTo('home');
}

/* ----------------------------
   Theme
----------------------------- */
function applyTheme(theme) {
  const t = theme === 'light' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', t);
  const label = document.getElementById('themeLabel');
  if (label) label.textContent = t === 'dark' ? '[ NOX ]' : '[ LUX ]';
  data.theme = t;
  saveData(data);
}

function toggleTheme() {
  const cur = document.documentElement.getAttribute('data-theme') || 'dark';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}

/* ----------------------------
   Modal
----------------------------- */
function showModal(title, message) {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-message').textContent = message;
  document.getElementById('modal-confirm').classList.add('active');
}

function hideModal() {
  document.getElementById('modal-confirm').classList.remove('active');
}

/* ----------------------------
   Praxis: mood selection + timer
----------------------------- */
let preMood = null;
let postMood = null;

function selectScale(containerId, val) {
  const root = document.getElementById(containerId);
  if (!root) return;
  root.querySelectorAll('.mood-scale-btn').forEach(b => b.classList.remove('selected'));
  const btn = root.querySelector(`.mood-scale-btn[data-mood="${val}"]`);
  btn?.classList.add('selected');
}

function selectPreMood(val) {
  preMood = val;
  selectScale('pre-mood-scale', val);
  const startBtn = document.getElementById('start-praxis-btn');
  if (startBtn) startBtn.disabled = false;
}

function selectPostMood(val) {
  postMood = val;
  selectScale('post-mood-scale', val);
  const saveBtn = document.getElementById('save-session-btn');
  if (saveBtn) saveBtn.disabled = false;
}

const SKILLS = [
  { key: 'praise',   label: 'Labeled Praise', hint: '"I love how carefully you\'re doing that!"' },
  { key: 'reflect',  label: 'Reflection',     hint: '"You\'re saying you wanted the blue one."' },
  { key: 'imitate',  label: 'Imitation',      hint: 'Copy their play actions briefly.' },
  { key: 'describe', label: 'Description',    hint: '"You\'re stacking the blocks so tall."' },
  { key: 'enjoy',    label: 'Enjoyment',      hint: 'Warm attentionâ€”smile, nod, stay present.' }
];

let skillIdx = 0;
let skillCounts = { praise: 0, reflect: 0, imitate: 0, describe: 0, enjoy: 0 };

let timerInterval = null;
let remainingSec = 15 * 60;
let sessionStart = null;

function setSkillPrompt() {
  const s = SKILLS[skillIdx];
  const t = document.getElementById('skill-prompt-text');
  const h = document.getElementById('skill-prompt-hint');
  const c = document.getElementById('skill-count');
  if (t) t.textContent = s.label;
  if (h) h.textContent = s.hint;
  if (c) c.textContent = String(skillCounts[s.key] || 0);
}

function nextSkillPrompt() {
  skillIdx = (skillIdx + 1) % SKILLS.length;
  setSkillPrompt();
}

function incrementSkill() {
  const s = SKILLS[skillIdx];
  skillCounts[s.key] = (skillCounts[s.key] || 0) + 1;
  const c = document.getElementById('skill-count');
  if (c) c.textContent = String(skillCounts[s.key]);
}

function decrementSkill() {
  const s = SKILLS[skillIdx];
  skillCounts[s.key] = Math.max(0, (skillCounts[s.key] || 0) - 1);
  const c = document.getElementById('skill-count');
  if (c) c.textContent = String(skillCounts[s.key]);
}

function fmtTime(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function setRingProgress(secLeft, totalSec) {
  const circle = document.getElementById('timer-progress');
  if (!circle) return;
  const circumference = 565; // matches your CSS dasharray
  const ratio = Math.max(0, Math.min(1, secLeft / totalSec));
  circle.style.strokeDashoffset = String(circumference * (1 - ratio));
}

function tickTimer() {
  remainingSec = Math.max(0, remainingSec - 1);
  const td = document.getElementById('timer-display');
  if (td) td.textContent = fmtTime(remainingSec);
  setRingProgress(remainingSec, 15 * 60);

  if (remainingSec <= 0) {
    completePraxis();
  }
}

function startPraxis() {
  remainingSec = 15 * 60;
  sessionStart = Date.now();
  skillIdx = 0;
  skillCounts = { praise: 0, reflect: 0, imitate: 0, describe: 0, enjoy: 0 };

  showView('view-praxis-active');
  setSkillPrompt();
  const td = document.getElementById('timer-display');
  if (td) td.textContent = '15:00';
  setRingProgress(remainingSec, 15 * 60);

  clearInterval(timerInterval);
  timerInterval = setInterval(tickTimer, 1000);
}

function endPraxisEarly() {
  completePraxis(true);
}

function completePraxis(early = false) {
  clearInterval(timerInterval);
  timerInterval = null;

  const elapsedMin = sessionStart ? Math.max(1, Math.round((Date.now() - sessionStart) / 60000)) : 15;
  const dur = document.getElementById('session-duration');
  if (dur) dur.textContent = String(early ? elapsedMin : 15);

  const fp = document.getElementById('final-praise');
  const fr = document.getElementById('final-reflect');
  const fd = document.getElementById('final-describe');
  if (fp) fp.textContent = String(skillCounts.praise);
  if (fr) fr.textContent = String(skillCounts.reflect);
  if (fd) fd.textContent = String(skillCounts.describe);

  showView('view-praxis-complete');
}

function saveSession() {
  if (!postMood) return;

  const notes = (document.getElementById('session-notes')?.value || '').trim();
  const durationMin = Number(document.getElementById('session-duration')?.textContent || '15');

  data.sessions.push({
    date: new Date().toISOString(),
    durationMin,
    preMood,
    postMood,
    skills: structuredClone(skillCounts),
    notes
  });

  saveData(data);
  
  // Reset form state
  preMood = null;
  postMood = null;
  const notesEl = document.getElementById('session-notes');
  if (notesEl) notesEl.value = '';
  document.querySelectorAll('#pre-mood-scale .mood-scale-btn, #post-mood-scale .mood-scale-btn')
    .forEach(btn => btn.classList.remove('selected'));
  const startBtn = document.getElementById('start-praxis-btn');
  const saveBtn = document.getElementById('save-session-btn');
  if (startBtn) startBtn.disabled = true;
  if (saveBtn) saveBtn.disabled = true;
  
  showModal('Confirmed', 'Your session has been recorded.');
  navigateTo('home');
  updateDashboard();
}

/* ----------------------------
   Status gauge + vocabulary (basic)
----------------------------- */
function attachGauge(trackId, handleId) {
  const track = document.getElementById(trackId);
  const handle = document.getElementById(handleId);
  if (!track || !handle) return;

  const setFromClientX = (clientX) => {
    const r = track.getBoundingClientRect();
    const x = Math.min(r.right, Math.max(r.left, clientX));
    const pct = (x - r.left) / r.width;
    const val = Math.min(10, Math.max(1, Math.round(1 + pct * 9)));
    handle.textContent = String(val);
    handle.style.left = `${pct * 100}%`;
  };

  const onDown = (e) => {
    handle.setPointerCapture?.(e.pointerId);
    setFromClientX(e.clientX);
  };
  const onMove = (e) => {
    if (e.buttons) setFromClientX(e.clientX);
  };

  handle.addEventListener('pointerdown', onDown);
  track.addEventListener('pointermove', onMove);
  track.addEventListener('pointerdown', (e) => setFromClientX(e.clientX));
}

const STATE_WORDS = ['Stable', 'Tense', 'Overloaded', 'Distracted', 'Frustrated', 'Wired', 'Sad', 'Hungry', 'Tired', 'Anxious'];
let selectedStateWords = new Set();

function renderStateVocabulary() {
  const root = document.getElementById('state-vocabulary');
  if (!root) return;
  root.innerHTML = '';
  STATE_WORDS.forEach(w => {
    const el = document.createElement('span');
    el.className = 'state-word';
    el.textContent = w;
    el.addEventListener('click', () => {
      if (selectedStateWords.has(w)) {
        selectedStateWords.delete(w);
        el.classList.remove('selected');
      } else {
        selectedStateWords.add(w);
        el.classList.add('selected');
      }
    });
    root.appendChild(el);
  });
}

function saveStatusCheckin() {
  const intensity = Number(document.getElementById('gauge-handle')?.textContent || '5');
  const context = (document.getElementById('status-context')?.value || '').trim();
  data.statusCheckins.push({
    date: new Date().toISOString(),
    intensity,
    words: Array.from(selectedStateWords),
    context
  });
  saveData(data);
  
  // Reset form state
  selectedStateWords.clear();
  const contextEl = document.getElementById('status-context');
  if (contextEl) contextEl.value = '';
  document.querySelectorAll('#state-vocabulary .state-word').forEach(el => el.classList.remove('selected'));
  const handleEl = document.getElementById('gauge-handle');
  if (handleEl) {
    handleEl.textContent = '5';
    handleEl.style.left = '50%';
  }
  
  showModal('Confirmed', 'Status check-in saved.');
  navigateTo('home');
  updateDashboard();
}

/* ----------------------------
   Episodes (Log Episode screen)
----------------------------- */
let selectedInterventions = new Set();

function toggleIntervention(el, key) {
  if (selectedInterventions.has(key)) {
    selectedInterventions.delete(key);
    el.classList.remove('selected');
  } else {
    selectedInterventions.add(key);
    el.classList.add('selected');
  }
}

function saveEpisode() {
  const intensity = Number(document.getElementById('episode-gauge-handle')?.textContent || '5');
  const trigger = (document.getElementById('episode-trigger')?.value || '').trim();
  const durationMin = Number(document.getElementById('episode-duration')?.value || '0') || null;
  const notes = (document.getElementById('episode-notes')?.value || '').trim();

  data.episodes.push({
    date: new Date().toISOString(),
    intensity,
    trigger,
    durationMin,
    interventions: Array.from(selectedInterventions),
    notes
  });

  saveData(data);
  
  // Reset form state
  selectedInterventions.clear();
  const triggerEl = document.getElementById('episode-trigger');
  const durationEl = document.getElementById('episode-duration');
  const notesEl = document.getElementById('episode-notes');
  if (triggerEl) triggerEl.value = '';
  if (durationEl) durationEl.value = '';
  if (notesEl) notesEl.value = '';
  document.querySelectorAll('#intervention-options .state-word').forEach(el => el.classList.remove('selected'));
  const handleEl = document.getElementById('episode-gauge-handle');
  if (handleEl) {
    handleEl.textContent = '5';
    handleEl.style.left = '50%';
  }
  
  showModal('Confirmed', 'Episode recorded.');
  navigateTo('home');
  updateDashboard();
}

/* ----------------------------
   Progressio
----------------------------- */
function updateProgressio() {
  const cal = document.getElementById('progressio-calendar');
  if (!cal) return;

  const today = new Date();
  const sessions = data.sessions || [];
  const sessionDates = new Set(sessions.map(s => (s.date || '').slice(0, 10)));

  const dayLabels = ['S','M','T','W','T','F','S'];
  const days = [];
  for (let i = 6; i >= 0; i--) {
    const x = new Date(today);
    x.setDate(x.getDate() - i);
    days.push(x);
  }

  cal.innerHTML = days.map(x => {
    const ds = x.toISOString().slice(0, 10);
    const isToday = ds === today.toISOString().slice(0, 10);
    const done = sessionDates.has(ds);
    return `<div class="calendar-day ${done ? 'completed' : ''} ${isToday ? 'today' : ''}">${dayLabels[x.getDay()]}</div>`;
  }).join('');

  document.getElementById('progress-streak').textContent = String(computeStreak(sessionDates));
  document.getElementById('progress-sessions').textContent = String(sessions.length);
  document.getElementById('progress-episodes').textContent = String((data.episodes || []).length);

  const weekKeys = new Set(days.map(d => d.toISOString().slice(0, 10)));
  const weekSessions = sessions.filter(s => weekKeys.has((s.date || '').slice(0, 10)));
  const totals = { praise: 0, reflect: 0, describe: 0 };

  weekSessions.forEach(s => {
    totals.praise += Number(s.skills?.praise || 0);
    totals.reflect += Number(s.skills?.reflect || 0);
    totals.describe += Number(s.skills?.describe || 0);
  });

  document.getElementById('weekly-praise').textContent = String(totals.praise);
  document.getElementById('weekly-reflect').textContent = String(totals.reflect);
  document.getElementById('weekly-describe').textContent = String(totals.describe);
}

/* ----------------------------
   Filius mood (simple highlight)
----------------------------- */
function selectFiliusMood(val, btn) {
  document.querySelectorAll('#filius-mood-grid .mood-btn').forEach(b => b.classList.remove('selected'));
  btn?.classList.add('selected');
}

/* ----------------------------
   Respiro (simple stepper)
----------------------------- */
const RESPIRO_STEPS = [
  { key: 'halt',    title: 'Halt',    text: 'Freeze. Do not react. Pause here.', cls: 'step-halt' },
  { key: 'retreat', title: 'Retreat', text: 'Create space. Lower intensity.',     cls: 'step-retreat' },
  { key: 'breathe', title: 'Breathe', text: 'Slow down your body first.',         cls: 'step-breathe' },
  { key: 'reflect', title: 'Reflect', text: 'Name the feeling and the need.',     cls: 'step-reflect' },
  { key: 'resolve', title: 'Resolve', text: 'Choose the next best action.',       cls: 'step-resolve' }
];

let respiroIdx = 0;
let filiusRespiroIdx = 0;

function renderRespiro(prefix, idx) {
  const step = RESPIRO_STEPS[idx];
  const dots = document.getElementById(prefix + 'dots');
  const visual = document.getElementById(prefix + 'visual');
  const title = document.getElementById(prefix + 'title');
  const instr = document.getElementById(prefix + 'instruction');
  const prev = document.getElementById(prefix + 'prev');
  const next = document.getElementById(prefix + 'next');

  if (dots) {
    [...dots.children].forEach((d, i) => d.classList.toggle('active', i === idx));
  }
  if (visual) {
    visual.className = `respiro-visual ${step.cls}`;
  }
  if (title) title.textContent = step.title;
  if (instr) instr.textContent = step.text;
  if (prev) prev.disabled = idx === 0;
  if (next) next.textContent = idx === RESPIRO_STEPS.length - 1 ? '[ Done ]' : '[ Next ]';
}

function respiroNext() {
  if (respiroIdx < RESPIRO_STEPS.length - 1) respiroIdx++;
  else { navigateTo('home'); return; }
  renderRespiro('respiro-', respiroIdx);
}
function respiroPrev() {
  respiroIdx = Math.max(0, respiroIdx - 1);
  renderRespiro('respiro-', respiroIdx);
}

function filiusRespiroNext() {
  if (filiusRespiroIdx < RESPIRO_STEPS.length - 1) filiusRespiroIdx++;
  else { showView('view-filius-home'); return; }
  renderRespiro('filius-respiro-', filiusRespiroIdx);
}
function filiusRespiroPrev() {
  filiusRespiroIdx = Math.max(0, filiusRespiroIdx - 1);
  renderRespiro('filius-respiro-', filiusRespiroIdx);
}

/* ----------------------------
   Breathing pacer text
----------------------------- */
(function breathingLoop(){
  const texts = ['Inhale','Hold','Exhale','Hold'];
  const durs  = [4000, 1000, 4000, 1000];
  let i = 0;

  function update() {
    const p = document.getElementById('breathing-text');
    const f = document.getElementById('filius-breathing-text');
    if (p) p.textContent = texts[i];
    if (f) f.textContent = texts[i];
    setTimeout(() => { i = (i + 1) % texts.length; update(); }, durs[i]);
  }
  update();
})();

/* ----------------------------
   Init
----------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  applyTheme(data.theme);
  attachGauge('gauge-track', 'gauge-handle');
  attachGauge('episode-gauge-track', 'episode-gauge-handle');
  renderStateVocabulary();

  navigateTo('home');

  renderRespiro('respiro-', respiroIdx);
  renderRespiro('filius-respiro-', filiusRespiroIdx);

  updateDashboard();
});
</script>

</body>
</html>
